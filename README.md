# Детектор аннотаций в PDF-документах

Проект для автоматического извлечения аннотаций из PDF-документов с использованием технологий оптического распознавания текста (OCR) и трансформеров для определения границ аннотации.

## Описание проекта

Система представляет собой полный пайплайн, включающий:
1. Обработку PDF-документов и извлечение текста с помощью OCR (Tesseract)
2. Постобработку и очистку текста
3. Определение границ аннотации с использованием модели на основе трансформеров
4. Полностью автоматизированный процесс от подачи PDF до получения текста аннотации

## Структура проекта

```
annotation-detection/
├── extract-text-from-pdf/        # Модуль обработки PDF и извлечения текста
│   ├── config.py                 # Конфигурация OCR и обработки текста
│   ├── image_processor.py        # Предобработка изображений
│   ├── ocr_engine.py             # OCR движок
│   ├── pdf_processor.py          # Обработчик PDF
│   ├── text_processor.py         # Обработка и очистка текста
│   ├── text_postprocessor.py     # Постобработка текста
│   ├── utils.py                  # Утилиты
│   └── ru-100k.txt               # Словарь для исправления опечаток
│
├── model/                        # Модуль машинного обучения
│   ├── config.py                 # Конфигурация модели
│   ├── dataset_loader.py         # Загрузка и подготовка данных
│   ├── model_trainer.py          # Обучение модели
│   ├── predict.py                # Предсказание аннотаций
│   └── models/                   # Сохраненные модели
│
├── prepare-dataset-for-training/ # Модуль подготовки обучающего датасета
│   ├── dataset_creator.py        # Скрипт создания датасета
│   └── dataset/                  # Обучающий датасет
│
├── pipeline.py                   # Единый пайплайн для обработки PDF и извлечения аннотаций
├── requirements.txt              # Зависимости проекта
└── README.md                     # Документация
```

## Технологии

- **OCR**: Tesseract, PDF2Image
- **Обработка текста**: NLTK, SpaCy, SymSpellPy, PyMorphy3
- **Машинное обучение**: PyTorch, Transformers (Hugging Face), PEFT (Parameter-Efficient Fine-Tuning)
- **Модель**: Дообученная RuBERT для задачи NER (Named Entity Recognition)

## Установка и настройка

### Предварительные требования

- Python 3.8+
- Tesseract OCR
- Poppler (для PDF2Image)

### Установка Tesseract OCR

#### Windows
1. Скачайте установщик Tesseract с [официального сайта](https://github.com/UB-Mannheim/tesseract/wiki)
2. Установите с поддержкой русского и английского языков
3. Добавьте путь к исполняемому файлу в конфигурацию (`extract-text-from-pdf/config.py`)

#### Linux
```bash
sudo apt-get install tesseract-ocr
sudo apt-get install tesseract-ocr-rus tesseract-ocr-eng
```

### Установка Poppler

#### Windows
1. Скачайте бинарные файлы Poppler с [сайта](https://github.com/oschwartz10612/poppler-windows/releases/)
2. Распакуйте в удобное место
3. Добавьте путь к бинарным файлам в конфигурацию (`extract-text-from-pdf/config.py`)

#### Linux
```bash
sudo apt install libnss3-dev
sudo apt install libgpgme-dev
sudo apt-get install poppler-utils
```

### Установка зависимостей проекта

```bash
pip install -r requirements.txt
```

## Конфигурация

### Настройка OCR и обработки текста (`extract-text-from-pdf/config.py`)

- `TESSERACT_PATH`: Путь к исполняемому файлу Tesseract
- `POPPLER_PATH`: Путь к директории с бинарными файлами Poppler
- `OCR_LANG`: Языки для распознавания текста
- `OCR_DPI`: Разрешение для конвертации PDF в изображения
- `PREPROCESSING_ENABLED`: Включение предобработки изображений
- `POSTPROCESSING_ENABLED`: Включение постобработки текста

### Настройка модели (`model/config.py`)

- `MODEL_NAME`: Имя предобученной модели (трансформера)
- `DEVICE`: Устройство для использования (CPU/CUDA)
- `MAX_LENGTH`: Максимальная длина последовательности токенов
- `SLIDING_WINDOW`: Использование скользящего окна для длинных текстов
- `MAX_TEXT_LENGTH_FOR_PREDICTION`: Максимальная длина текста для анализа

## Использование

### Полный пайплайн обработки PDF и извлечения аннотации

Для запуска полного процесса от PDF до аннотации используйте скрипт `pipeline.py`:

```python
from pipeline import process_pdf_file

# Путь к PDF-файлу
pdf_path = "path/to/your/document.pdf"

# Получение аннотации
annotation = process_pdf_file(pdf_path)
print(annotation)
```

Или запустите скрипт напрямую:

```bash
python pipeline.py
```
По умолчанию скрипт будет обрабатывать файл `test.pdf` в корневой директории проекта. Для использования другого файла отредактируйте переменную `pdf_path` в блоке `if __name__ == "__main__"` скрипта.

### Обучение модели

1. Подготовьте датасет с помощью `prepare-dataset-for-training/dataset_creator.py`
2. Настройте параметры обучения в `model/config.py`
3. Запустите обучение:

```bash
python -m model.model_trainer
```
*Или добавьте готовую модель в model/models вручную*

### Предсказание аннотаций без OCR

Если у вас уже есть текстовый файл и нужно только извлечь аннотацию:

1. Укажите путь к файлу в `model/config.py` (параметр `PREDICT_FILE_PATH`)
2. Запустите:

```bash
python -m model.predict
```

## Принцип работы

### 1. Обработка PDF и извлечение текста

- PDF конвертируется в набор изображений
- Для каждого изображения применяется предобработка (опционально) для улучшения качества
- Tesseract OCR распознает текст на каждом изображении
- Все тексты объединяются

### 2. Постобработка текста

- Нормализация пробелов и знаков препинания
- Коррекция опечаток с помощью SymSpellPy
- Удаление артефактов распознавания
- Лингвистическая обработка с помощью SpaCy/PyMorphy3

### 3. Определение границ аннотации

- Текст разбивается на части с перекрытием (для длинных текстов)
- Модель на основе трансформера анализирует каждую часть и определяет токены, относящиеся к аннотации
- Определяются начальные и конечные границы аннотации
- Фрагменты объединяются, учитывая перекрытия
- Выбирается наиболее вероятная аннотация с учетом позиции в тексте и уверенности модели

## Особенности модели

Модель обучена на основе RuBERT (DeepPavlov/rubert-base-cased) для задачи распознавания именованных сущностей (NER), где аннотация рассматривается как именованная сущность с двумя типами токенов:
- `B-ANN`: Начало аннотации
- `I-ANN`: Продолжение аннотации

Модель учитывает контекст и способна распознавать аннотации различных стилей и форматов.

## Авторы

Лабутин Иван Олегович (pxleblank)


Проект разработан в рамках задачи по автоматизации извлечения аннотаций из PDF-документов научного и образовательного характера. 
